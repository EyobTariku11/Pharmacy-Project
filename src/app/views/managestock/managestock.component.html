<div class="manage-stock-container">
  <!-- Header -->
  <div class="header-section">
    <h2>Manage Stock</h2>
    <div class="header-actions">
      <input
        type="text"
        class="search-input"
        placeholder="Search products or categories..."
        [(ngModel)]="searchTerm"
      />
      <button class="add-btn" (click)="toggleForm()">Add Stock</button>
    </div>
  </div>

  <!-- Table Section -->
  <div class="table-wrapper">
    <table class="stock-table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Category</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Created At</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let stock of paginatedStock; let i = index">
          <td>{{ stock.product }}</td>
          <td>{{ stock.category }}</td>
          <td>{{ stock.quantity }}</td>
          <td>{{ stock.price }}</td>
          <td>{{ stock.createdAt }}</td>
          <td>
            <span [ngClass]="getStockStatus(stock).className">
              {{ getStockStatus(stock).text }}
            </span>
          </td>
          <td>
            <button class="edit-btn" (click)="toggleForm(stock)">Edit</button>
            <button class="delete-btn" (click)="deleteStock(stock, i)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
    <button
      *ngFor="let page of totalPagesArray"
      (click)="goToPage(page)"
      [class.active]="page === currentPage"
    >
      {{ page }}
    </button>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
  </div>

  <!-- Add/Edit Stock Modal Form -->
  <div class="add-stock-form" *ngIf="showForm">
    <div class="form-box">
      <h3>{{ isEditMode ? 'Edit Stock' : 'Add New Stock' }}</h3>

      <form (ngSubmit)="addStock()" novalidate>
        <div class="form-group">
          <input
            type="text"
            id="product"
            name="product"
            [(ngModel)]="newStock.product"
            placeholder=" "
            required
          />
          <label for="product">Product Name</label>
        </div>

        <!-- Category Dropdown -->
        <div class="form-group">
          <select
            id="category"
            name="category"
            [(ngModel)]="newStock.category"
            (change)="onCategoryChange()"
            required
          >
            <option value="" disabled hidden>Choose Category</option>
            <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            <option value="__add_new__">âž• Add New Category</option>
          </select>
          <label for="category">Category</label>
        </div>

        <!-- New Category Input -->
        <div class="form-group" *ngIf="addingNewCategory">
          <input
            type="text"
            id="newCategory"
            name="newCategory"
            [(ngModel)]="customCategory"
            placeholder=" "
            required
          />
          <label for="newCategory">New Category Name</label>
          <button type="button" class="add-category-btn" (click)="addCustomCategory()">
            Add Category
          </button>
        </div>

        <div class="form-group">
          <input
            type="number"
            id="quantity"
            name="quantity"
            [(ngModel)]="newStock.quantity"
            placeholder=" "
            required
          />
          <label for="quantity">Quantity</label>
        </div>

        <div class="form-group">
          <input
            type="number"
            id="price"
            name="price"
            [(ngModel)]="newStock.price"
            placeholder=" "
            required
          />
          <label for="price">Price</label>
        </div>

        <div class="form-buttons">
          <button type="submit" class="save-btn">
            {{ isEditMode ? 'Update' : 'Save' }}
          </button>
          <button type="button" class="cancel-btn" (click)="cancel()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
